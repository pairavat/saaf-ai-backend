generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["nativeTypes"]
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model activity_logs {
  id          BigInt    @id @default(autoincrement())
  user_id     BigInt?
  action      String?   @db.VarChar(255)
  target_type String?   @db.VarChar(50)
  target_id   BigInt?
  metadata    Json?     @db.Json
  options     String?
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  users       users?    @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model companies {
  id                 BigInt               @id @default(autoincrement())
  name               String               @db.VarChar(255)
  description        String?
  contact_email      String?              @db.VarChar(255)
  created_at         DateTime?            @default(now()) @db.Timestamp(6)
  updated_at         DateTime?            @default(now()) @db.Timestamp(6)
  status             Boolean              @default(true)
  deletedAt          DateTime?
  cleaner_review     cleaner_review[]     @relation("CompanyReviews")
  facility_companies facility_companies[]
  location_types     location_types[]
  locations          locations[]
  registered_users   registered_users[]
  shifts             shifts[]
  user_reviews       user_review[]        @relation("CompanyUserReviews")
  users              users[]
}

model hygiene_scores {
  id             BigInt           @id @default(autoincrement())
  location_id    BigInt?
  score          Decimal?         @db.Decimal(5, 2)
  details        Json?            @db.Json
  image_url      String?          @db.VarChar(255)
  inspected_at   DateTime         @db.Timestamp(6)
  created_by     BigInt?
  created_at     DateTime?        @default(now()) @db.Timestamp(6)
  is_modified    Boolean          @default(false)
  original_score Decimal?         @db.Decimal(5, 2)
  company_id     BigInt?
  updated_at     DateTime?        @db.Timestamp(6)
  cleaner_review cleaner_review[]
  users          users?           @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  locations      locations?       @relation(fields: [location_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model locations {
  id                     BigInt                @id @default(autoincrement())
  name                   String                @db.VarChar(255)
  parent_id              BigInt?
  company_id             BigInt?
  latitude               Float?
  longitude              Float?
  metadata               Json?                 @db.Json
  created_at             DateTime?             @default(now()) @db.Timestamp(6)
  updated_at             DateTime?             @default(now()) @db.Timestamp(6)
  type_id                BigInt?
  options                Json?                 @default("{}")
  lang_preference        String?               @db.VarChar(255)
  images                 String[]
  deletedAt              DateTime?
  address                String?
  average_cleaning_score Float?
  city                   String?
  current_cleaning_score Float?
  dist                   String?
  status                 Boolean?
  user_review_score      Float?
  pincode                String?
  state                  String?
  facility_companiesId   BigInt?
  no_of_photos           Int?
  usage_category         Json?                 @db.Json
  close_time             DateTime?             @db.Time(6)
  open_time              DateTime?             @db.Time(6)
  cleaner_assignments    cleaner_assignments[]
  cleaner_reviews        cleaner_review[]      @relation("LocationReviews")
  hygiene_scores         hygiene_scores[]
  companies              companies?            @relation(fields: [company_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  facility_companies     facility_companies?   @relation(fields: [facility_companiesId], references: [id])
  locations              locations?            @relation("locationsTolocations", fields: [parent_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  other_locations        locations[]           @relation("locationsTolocations")
  location_types         location_types?       @relation(fields: [type_id], references: [id], onUpdate: NoAction)
  saved_by_users         saved_locations[]
  user_reviews           user_review[]         @relation("LocationUserReviews")
}

model location_types {
  id                   BigInt           @id @default(autoincrement())
  name                 String           @db.VarChar(100)
  parent_id            BigInt?
  company_id           BigInt?
  sort_order           Int?
  created_at           DateTime?        @default(now()) @db.Timestamp(6)
  updated_at           DateTime?        @default(now()) @db.Timestamp(6)
  is_toilet            Boolean?
  deletedAt            DateTime?
  companies            companies?       @relation(fields: [company_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  location_types       location_types?  @relation("location_typesTolocation_types", fields: [parent_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  other_location_types location_types[] @relation("location_typesTolocation_types")
  locations            locations[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model review {
  id            BigInt          @id @default(autoincrement())
  user_id       BigInt
  site_id       Int
  rating        Int?
  comment       String?
  image_urls    String[]
  created_at    DateTime?       @default(now()) @db.Timestamp(6)
  updated_at    DateTime?       @default(now()) @db.Timestamp(6)
  review_photos review_photos[]
}

model review_photos {
  id         BigInt    @id
  user_id    BigInt?
  image_url  String?   @db.VarChar(255)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  review     review?   @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model sessions {
  id         BigInt    @id @default(autoincrement())
  user_id    BigInt?
  token      String?   @unique @db.VarChar(255)
  expires_at DateTime? @db.Timestamp(6)
  created_at DateTime? @default(now()) @db.Timestamp(6)
  users      users?    @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model users {
  id                                BigInt                @id @default(autoincrement())
  name                              String                @db.VarChar(255)
  email                             String?               @unique @db.VarChar(255)
  password                          String?
  company_id                        BigInt?
  created_at                        DateTime?             @default(now()) @db.Timestamp(6)
  updated_at                        DateTime?             @default(now()) @db.Timestamp(6)
  phone                             String?               @unique(map: "unique_phone") @db.VarChar(15)
  age                               Int?
  birthdate                         DateTime?             @db.Date
  role_id                           Int?
  deletedAt                         DateTime?
  token                             String?
  fcm_token                         String?               @db.VarChar(255)
  avatar_url                        String?
  google_id                         String?               @unique
  activity_logs                     activity_logs[]
  cleaner_assignments_as_cleaner    cleaner_assignments[] @relation("CleanerUser")
  cleaner_assignments_as_supervisor cleaner_assignments[] @relation("Supervisor")
  cleaner_reviews                   cleaner_review[]      @relation("CleanerReviews")
  hygiene_scores                    hygiene_scores[]
  refresh_tokens                    refresh_tokens[]
  saved_locations                   saved_locations[]
  sessions                          sessions[]
  shift_assignments                 shift_assignments[]
  user_reviews                      user_review[]         @relation("UserReviews")
  companies                         companies?            @relation(fields: [company_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  role                              Role?                 @relation(fields: [role_id], references: [id])
}

model configurations {
  id          BigInt   @id @default(autoincrement())
  name        String   @unique @db.VarChar(255)
  description Json?
  company_id  BigInt?
  is_active   Boolean  @default(false)
  notes       String?
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  updated_at  DateTime @default(now()) @db.Timestamptz(6)
}

model cleaner_review {
  id               BigInt          @id @default(autoincrement())
  name             String
  latitude         Float?
  longitude        Float?
  address          String?
  created_at       DateTime?       @default(now()) @db.Timestamptz(6)
  updated_at       DateTime?       @db.Timestamptz(6)
  location_id      BigInt?
  cleaner_user_id  BigInt?
  tasks            String[]
  initial_comment  String?
  final_comment    String?
  before_photo     String[]
  after_photo      String[]
  status           String          @default("ongoing")
  company_id       BigInt?
  score            Float?
  is_modified      Boolean         @default(false)
  original_score   Float?
  hygiene_score_id BigInt?
  cleaner_user     users?          @relation("CleanerReviews", fields: [cleaner_user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  company          companies?      @relation("CompanyReviews", fields: [company_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  hygiene_scores   hygiene_scores? @relation(fields: [hygiene_score_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  location         locations?      @relation("LocationReviews", fields: [location_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model user_review_qr {
  id          BigInt    @id @default(autoincrement())
  toilet_id   BigInt?
  name        String?   @db.VarChar(100)
  email       String?   @db.VarChar(100)
  phone       String?   @db.VarChar(20)
  rating      Float?
  description String?
  reason_ids  Int[]
  images      String[]
  created_at  DateTime? @default(now()) @db.Timestamptz(6)
  updated_at  DateTime? @default(now()) @db.Timestamptz(6)
  longitude   Float?
  latitude    Float?
  ai_score    Float?
  company_id  BigInt?
}

model user_review {
  id          BigInt     @id @default(autoincrement())
  toilet_id   BigInt?
  rating      Float
  description String?
  reason_ids  Int[]
  images      String[]
  created_at  DateTime   @default(now())
  updated_at  DateTime   @updatedAt
  longitude   Float?
  latitude    Float?
  ai_score    Float?
  company_id  BigInt?
  anonymous   Boolean    @default(false)
  /// ---------------- CORE ----------------
  location_id BigInt?
  user_id     BigInt?
  company     companies? @relation("CompanyUserReviews", fields: [company_id], references: [id])
  location    locations? @relation("LocationUserReviews", fields: [location_id], references: [id], onDelete: Cascade)
  user        users?     @relation("UserReviews", fields: [user_id], references: [id])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model spatial_ref_sys {
  srid      Int     @id
  auth_name String? @db.VarChar(256)
  auth_srid Int?
  srtext    String? @db.VarChar(2048)
  proj4text String? @db.VarChar(2048)
}

model cleaner_assignments {
  id              BigInt     @id @default(autoincrement())
  name            String     @db.VarChar(255)
  cleaner_user_id BigInt
  company_id      BigInt
  type_id         BigInt?
  location_id     BigInt?
  status          String?    @default("unassigned") @db.VarChar(50)
  assigned_on     DateTime?  @default(now()) @db.Timestamp(6)
  released_on     DateTime?  @db.Timestamp(6)
  created_at      DateTime?  @default(now()) @db.Timestamp(6)
  updated_at      DateTime?  @default(now()) @db.Timestamp(6)
  supervisor_id   BigInt?
  role_id         Int?
  deletedAt       DateTime?
  cleaner_user    users      @relation("CleanerUser", fields: [cleaner_user_id], references: [id])
  Role            Role?      @relation(fields: [role_id], references: [id])
  supervisor      users?     @relation("Supervisor", fields: [supervisor_id], references: [id])
  locations       locations? @relation(fields: [location_id], references: [id], onDelete: Cascade, map: "fk_assignments_location")
}

model Role {
  id                  Int                   @id @default(autoincrement())
  name                String                @unique @db.VarChar(50)
  description         String?
  permissions         String[]              @default([])
  is_active           Boolean               @default(true)
  created_at          DateTime?             @default(now())
  updated_at          DateTime?             @updatedAt
  company_id          BigInt?
  cleaner_assignments cleaner_assignments[]
  registered_users    registered_users[]
  shift_assignments   shift_assignments[]
  users               users[]
}

model registered_users {
  id                 BigInt    @id @default(autoincrement())
  company_id         BigInt
  name               String    @db.VarChar(255)
  phone              String    @unique @db.VarChar(15)
  role_id            Int
  temporary_password String?   @db.VarChar(255)
  is_verified        Boolean   @default(false)
  verification_token String?   @unique @db.VarChar(255)
  created_at         DateTime  @default(now()) @db.Timestamp(6)
  updated_at         DateTime  @default(now()) @db.Timestamp(6)
  companies          companies @relation(fields: [company_id], references: [id], onDelete: Cascade)
  role               Role      @relation(fields: [role_id], references: [id])
}

model facility_companies {
  id                      BigInt      @id @default(autoincrement())
  name                    String      @db.VarChar(255)
  email                   String?     @db.VarChar(255)
  phone                   String      @unique @db.VarChar(20)
  contact_person_name     String      @db.VarChar(255)
  contact_person_phone    String?     @db.VarChar(20)
  contact_person_email    String?     @db.VarChar(255)
  address                 String?
  city                    String?     @db.VarChar(100)
  state                   String?     @db.VarChar(100)
  pincode                 String?     @db.VarChar(10)
  country                 String?     @default("India") @db.VarChar(100)
  registration_number     String?     @unique @db.VarChar(100)
  pan_number              String?     @db.VarChar(20)
  license_number          String?     @db.VarChar(100)
  license_expiry_date     DateTime?   @db.Date
  contract_start_date     DateTime?   @db.Date
  contract_end_date       DateTime?   @db.Date
  rating                  Float?      @default(0)
  total_locations_managed Int         @default(0)
  active_locations        Int         @default(0)
  status                  Boolean     @default(true)
  description             String?
  company_id              BigInt
  created_at              DateTime    @default(now()) @db.Timestamp(6)
  updated_at              DateTime    @db.Timestamp(6)
  deletedAt               DateTime?
  companies               companies   @relation(fields: [company_id], references: [id], onDelete: Cascade)
  locations               locations[]
}

model shift_assignments {
  id        BigInt    @id @default(autoincrement())
  shiftId   BigInt
  user_id   BigInt
  startDate DateTime
  endDate   DateTime?
  status    String    @default("active") @db.VarChar(50)
  notes     String?
  createdAt DateTime  @default(now())
  updatedAt DateTime
  deletedAt DateTime?
  role_id   Int?
  Role      Role?     @relation(fields: [role_id], references: [id])
  shifts    shifts    @relation(fields: [shiftId], references: [id], onDelete: Cascade)
  users     users     @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model shifts {
  id                BigInt              @id @default(autoincrement())
  name              String?             @db.VarChar(255)
  description       String?
  durationHours     Float?
  effectiveFrom     DateTime?           @default(now())
  effectiveUntil    DateTime?
  createdAt         DateTime?           @default(now()) @db.Timestamp(6)
  updatedAt         DateTime?           @db.Timestamp(6)
  deletedAt         DateTime?
  company_id        BigInt?
  status            Boolean             @default(true)
  startTime         DateTime?           @db.Time(6)
  endTime           DateTime?           @db.Time(6)
  shift_assignments shift_assignments[]
  companies         companies?          @relation(fields: [company_id], references: [id], onDelete: Cascade)
}

model refresh_tokens {
  id         BigInt   @id @default(autoincrement())
  user_id    BigInt
  token      String   @unique
  expires_at DateTime
  created_at DateTime @default(now())
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model saved_locations {
  id          BigInt    @id @default(autoincrement())
  user_id     BigInt
  location_id BigInt
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  location    locations @relation(fields: [location_id], references: [id], onDelete: Cascade)
  user        users     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, location_id])
}
